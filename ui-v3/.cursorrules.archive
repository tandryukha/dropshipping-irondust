Project: supplements-mockup - Playwright + MCP guardrails

Primary goal
- After any meaningful UI change, validate desktop/mobile rendering via Playwright and report an evaluation result. Use the local MCP tools; never auto-update snapshots without explicit approval.

When to run checks (triggers)
- After edits to:
  - desktop7.html, index.html
  - tests/**, playwright.config.ts
  - **/*.{html,css,js,ts}
- Before commit, or when the user asks to "try it", "evaluate", or "run checks".

Execution order (MCP-first)
1) Run MCP tool: runTests
   - Parse JSON text result { ok, code, stdout, stderr }.
   - Define testsPassed := (ok === true && code === 0).
2) If testsPassed is false:
   - Do NOT run updateSnapshots.
   - Surface failing test names and the first relevant error lines.
   - Propose minimal code edits; re-run runTests after the edits.
3) If testsPassed is true:
   - Run MCP tool: evaluateJson with payload:
     {
       "prompt": "<short summary of the change and intended outcome>",
       "result": { "testsPassed": true },
       "criteria": [
         { "name": "tests pass", "check": "result && result.testsPassed === true" }
       ]
     }
   - Parse the evaluator output and report ok/score.

Visual snapshot policy
- Never run updateSnapshots automatically. Only execute MCP tool updateSnapshots when the user explicitly requests updating baselines.
- If visual diffs appear but are intentional, ask for confirmation before running updateSnapshots.

Performance & stability
- Skip tests for .md or non-UI docs unless asked.
- If MCP server is unavailable, fall back to shell equivalents:
  - npm run -s test
  - npm run -s test:update (only on explicit request)
  - node tools/evaluate-json.js

Coding guardrails for this project
- Do not reformat or re-indent unrelated code.
- Keep desktop layout snapshots stable while implementing mobile features unless told otherwise.
- Use visual snapshots to detect desktop regressions; update only with approval.

Reporting
- Provide a concise summary: pass/fail per project (desktop/mobile), any failing test names, and evaluator ok/score.
